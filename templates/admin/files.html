{% extends 'admin/template.html' %} {% block content %}

<div class="container mx-auto p-4">
  <h2 class="text-2xl font-bold mb-4">Uploaded Files</h2>

  <div
    class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2"
    id="file-grid"
  >
    <!-- Upload Button -->
    <div
      class="file-upload-item"
      onclick="document.getElementById('file-input').click()"
    >
      <img src="" />
      <span class="">Upload File</span>
    </div>

    <!-- Hidden File Input -->
<input
  type="file"
  id="file-input"
  class="hidden"
  hx-post="{{ url_for('admin.upload_file') }}"
  hx-target="#file-grid"
  hx-swap="beforeend"
  hx-trigger="fileSelected"
  hx-encoding="multipart/form-data"
  name="files"
  multiple
  accept=".png, .jpg, .jpeg, .gif, .bmp, .webp, .svg, .txt, .md, .csv, .log, .json, .xml, .pdf, .html"
/>

    <!-- Render Uploaded Files -->
    {% for file in files %} {% include 'admin/fragments/file_item.html' with
    context %} {% endfor %}
  </div>
</div>


<script>
  document.getElementById("file-input").addEventListener("change", function () {
    let formData = new FormData();
    for (let file of this.files) {
      formData.append("files", file);
    }

    fetch("{{ url_for('admin.upload_file') }}", {
      method: "POST",
      body: formData,
    })
    .then(response => response.text())
    .then(html => {
      document.getElementById("file-grid").insertAdjacentHTML("beforeend", html);
    })
    .catch(error => console.error("Upload error:", error));
  });
</script>

{% endblock %}
