{% extends 'user/base-min.html' %} {% block content %}
<!-- Sign In -->
<style>
  /* Simple styling for form validation */
  input:invalid, select:invalid {
    border-color: #ef4444;
  }
  input::placeholder{
    color:gray;
  }
  
  /* Error message styling */
  .error-text {
    color: #ef4444;
    font-size: 0.875rem;
    margin-top: 20px;
    margin-bottom: 10px;
    border-radius: 6px;
    position: relative;
  }
  
  
  .input-error {
    border: 1px solid #ef4444 !important;
    box-shadow: 0 0 0 1px #ef4444 !important;
  }

  /* Phone input container styling */
  .phone-input-container {
    display: flex;
    align-items: center;
    border: 1px solid var(--goglobe-site-bg-color);
    border-radius: 6px;
    background-color: var(--goglobe-input-color);
    transition: all 0.2s;
    overflow: hidden;
  }

  .phone-input-container:focus-within {
    border-color: var(--goglobe-main-color);
  }
</style>

<div style="display:flex; flex-direction:row;gap:15px; margin-bottom:20px;">
<svg width="57" height="56" viewBox="0 0 57 56" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M51.9725 32.2535C54.3799 19.3447 45.6728 6.89178 32.525 4.43975C19.3772 1.98772 6.7666 10.465 4.35916 23.3737C1.95171 36.2824 10.6589 48.7354 23.8067 51.1874L46.9641 55.5062L43.7422 46.1233C48.0544 42.5965 50.9659 37.6899 51.9725 32.2535Z" fill="white"/>
  <path d="M14.9164 27.0168V40.5406H41.5974L41.474 27.0168L40.2 20.4509L17.1704 21.7249L14.9164 27.0168Z" fill="#F7D5B1"/>
  <path d="M9.23244 16.1385L14.9164 27.0164L17.1703 21.7244L40.1999 20.4505L41.4739 27.0164L44.3159 17.2165L38.142 15.9425L40.1019 12.8066L36.721 13.2476L40.1509 8.54366L33.0951 11.7776L36.525 4.91772L26.1372 11.4836L25.1572 8.73966L9.23244 16.1385Z" fill="#52504D"/>
  <path d="M14.9412 40.3388V46.0213H41.2018V40.3125L14.9412 40.3388Z" fill="white"/>
  <path d="M17.6604 40.4421L28.2442 51.026L38.7301 40.4421H17.6604Z" fill="#E8EAEB"/>
  <path d="M18.3463 40.4421L22.1683 44.9501L28.1462 40.5401L34.2221 44.9501L38.044 40.4421H18.3463Z" fill="white"/>
  <path d="M28.1462 40.5403L26.0882 42.0103V42.5003H30.4001V42.0103L28.1462 40.5403Z" fill="#C95C1C"/>
  <path d="M28.0715 50.5885H31.4968L30.4001 42.5002H26.0882L25.2171 50.5885H28.0715Z" fill="#FF5E00"/>
  <path d="M28.3975 36.0812C30.3947 36.0812 32.2856 34.0523 32.0847 33.1945C31.8838 32.3367 30.3947 33.1945 28.3975 33.1945C26.4002 33.1945 24.9525 32.1927 24.852 33.1945C24.7516 34.1964 26.3588 35.9372 28.3975 36.0812Z" fill="#3B3731"/>
  <path d="M20.6335 28.1925C21.283 28.1925 21.8095 27.666 21.8095 27.0166C21.8095 26.3671 21.283 25.8406 20.6335 25.8406C19.9841 25.8406 19.4576 26.3671 19.4576 27.0166C19.4576 27.666 19.9841 28.1925 20.6335 28.1925Z" fill="#3B3731"/>
  <path d="M35.6275 28.1925C36.277 28.1925 36.8035 27.666 36.8035 27.0166C36.8035 26.3671 36.277 25.8406 35.6275 25.8406C34.978 25.8406 34.4515 26.3671 34.4515 27.0166C34.4515 27.666 34.978 28.1925 35.6275 28.1925Z" fill="#3B3731"/>
  <path d="M14.9164 27.0168V40.5406H41.5974L41.474 27.0168L40.2 20.4509L17.1704 21.7249L14.9164 27.0168Z" fill="#F7D5B1"/>
  <path d="M9.23244 16.1385L14.9164 27.0164L17.1703 21.7244L40.1999 20.4505L41.4739 27.0164L44.3159 17.2165L38.142 15.9425L40.1019 12.8066L36.721 13.2476L40.1509 8.54366L33.0951 11.7776L36.525 4.91772L26.1372 11.4836L25.1572 8.73966L9.23244 16.1385Z" fill="#52504D"/>
  <path d="M14.9412 40.3388V46.0213H41.2018V40.3125L14.9412 40.3388Z" fill="white"/>
  <path d="M17.6604 40.4421L28.2442 51.026L38.7301 40.4421H17.6604Z" fill="#E8EAEB"/>
  <path d="M18.3463 40.4421L22.1683 44.9501L28.1462 40.5401L34.2221 44.9501L38.044 40.4421H18.3463Z" fill="white"/>
  <path d="M28.1462 40.5403L26.0882 42.0103V42.5003H30.4001V42.0103L28.1462 40.5403Z" fill="#C95C1C"/>
  <path d="M28.0715 50.5885H31.4968L30.4001 42.5002H26.0882L25.2171 50.5885H28.0715Z" fill="#FF5E00"/>
  <path d="M28.3975 36.0812C30.3947 36.0812 32.2856 34.0523 32.0847 33.1945C31.8838 32.3367 30.3947 33.1945 28.3975 33.1945C26.4002 33.1945 24.9525 32.1927 24.852 33.1945C24.7516 34.1964 26.3588 35.9372 28.3975 36.0812Z" fill="#3B3731"/>
  <path d="M20.6335 28.1925C21.283 28.1925 21.8095 27.666 21.8095 27.0166C21.8095 26.3671 21.283 25.8406 20.6335 25.8406C19.9841 25.8406 19.4576 26.3671 19.4576 27.0166C19.4576 27.666 19.9841 28.1925 20.6335 28.1925Z" fill="#3B3731"/>
  <path d="M35.6275 28.1925C36.277 28.1925 36.8035 27.666 36.8035 27.0166C36.8035 26.3671 36.277 25.8406 35.6275 25.8406C34.978 25.8406 34.4515 26.3671 34.4515 27.0166C34.4515 27.666 34.978 28.1925 35.6275 28.1925Z" fill="#3B3731"/>
</svg>

    <p style="color: #FFF; font-size: 16px; font-style: normal; font-weight: 400; line-height: 20px; letter-spacing: -0.32px;">
        Let us know about you!
    </p>
</div>

<div style="overflow-y:hidden; background-color: var(--goglobe-site-bg-color); color: var(--goglobe-body-color); font-family: var(--goglobe-body-font-family); width: 100%;">
    <!-- Desktop logo would go here -->
    <div style="border-radius: 0.5rem; padding: 0.5rem; margin: 0 auto;">
        <div style="margin-bottom: 2rem;">
            <form id="login-form" novalidate>
                <div style="margin-bottom: 1rem; width: 100%;">
                    <input type="text"
                        style="font-family: var(--goglobe-body-font-family); width: 100%; border-radius: 6px; outline: none; border: 1px solid var(--goglobe-site-bg-color); padding: 12px; color: white; font-weight: bold; transition: all 0.2s; background-color: var(--goglobe-input-color); box-sizing: border-box;"
                        class='placeholder-[var(--goglobe-body-color)] placeholder-bold'
                        id="name" name="name" placeholder="Your Name*" autocapitalize="off"
                        autocomplete="name" required minlength="2"
                        onfocus="this.style.border = '1px solid var(--goglobe-main-color)';"
                        onblur="this.style.border = '1px solid var(--goglobe-site-bg-color)';">
                </div>

                {% if default_subject.lower() != "job" %}
                <div style="margin-bottom: 1rem; width: 100%;">
                    <input type="text"
                        style="font-family: var(--goglobe-body-font-family); width: 100%; border-radius: 6px; outline: none; border: 1px solid var(--goglobe-site-bg-color); padding: 12px; color: white; font-weight: bold; transition: all 0.2s; background-color: var(--goglobe-input-color); box-sizing: border-box;"
                        class='placeholder-[var(--goglobe-body-color)] placeholder-bold'
                        id="desg" name="desg" placeholder="Designation*" autocapitalize="off"
                        onfocus="this.style.border = '1px solid var(--goglobe-main-color)';"
                        onblur="this.style.border = '1px solid var(--goglobe-site-bg-color)';">
                </div>
                {% endif %}

                <div style="margin-bottom: 1rem; width: 100%;">
                    <input type="email"
                        style="font-family: var(--goglobe-body-font-family); width: 100%; border-radius: 6px; outline: none; border: 1px solid var(--goglobe-site-bg-color); padding: 12px; color: white; font-weight: bold; transition: all 0.2s; background-color: var(--goglobe-input-color); box-sizing: border-box;"
                        class='placeholder-[var(--goglobe-body-color)] placeholder-bold'
                        id="email" name="email" placeholder="Email Address*" autocapitalize="off"
                        autocomplete="email" required pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                        onfocus="this.style.border = '1px solid var(--goglobe-main-color)';"
                        onblur="this.style.border = '1px solid var(--goglobe-site-bg-color)';">
                </div>

                <div style="margin-bottom: 1rem; width: 100%;" class="hidden">
                    <select
                        style="font-family: var(--goglobe-body-font-family); width: 100%; border-radius: 6px; outline: none; border: 1px solid var(--goglobe-site-bg-color); padding: 12px; color: white; font-weight: bold; transition: all 0.2s; background-color: var(--goglobe-input-color); box-sizing: border-box;"
                        class='placeholder-[var(--goglobe-body-color)] placeholder-bold'
                        id="subject" name="subject" autocapitalize="off" autocomplete="off" required
                        onfocus="this.style.border = '1px solid var(--goglobe-main-color)';"
                        onblur="this.style.border = '1px solid var(--goglobe-site-bg-color)';">
                        {% for subject in settings['subjects'] %}
                        <option {% if default_subject and default_subject==subject %} selected='true' {% endif %}>
                            {{subject}}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Enhanced Phone Input -->
                <div style="margin-bottom: 1.5rem; width: 100%;">
                    <div class="phone-input-container" id="phone-container" style="width: 100%;">
                        <select class="country-selector" id="country-selector" name="country-code" style="font-family: var(--goglobe-body-font-family); padding: 12px; background: transparent; border: none; color: white;background-color:var(--goglobe-input-color); font-weight: bold; cursor: pointer; outline: none; width: 30%; 
                          ">
                            <!-- Countries will be populated by JavaScript -->
                        </select>
                        <input type="tel" 
                            class="phone-number-input placeholder-[var(--goglobe-body-color)] placeholder-bold"
                            style="font-family: var(--goglobe-body-font-family); flex: 1; border: none; outline: none; background: transparent; color: white; font-weight: bold; padding: 12px; width: 70%;"
                            id="phone" 
                            name="phone" 
                            placeholder="Phone Number*" 
                            autocomplete="tel" 
                            required>
                    </div>
                </div>

                <button type="submit" id="login-btn"
                    style=" box-sizing: border-box;font-family: var(--goglobe-body-font-family); font-weight:bold; color:white; padding: 0.75rem 1rem; background-color: var(--goglobe-main-color); border: 1px solid var(--goglobe-border-color); border-radius: 6px; transition: all 0.2s;"
                    onmouseover="this.style.opacity=0.7; this.style.cursor='pointer'"
                    onmouseout="this.style.opacity=1; this.style.cursor='auto'"
                    onmousedown="this.style.backgroundColor='var(--goglobe-site-bg)'"
                    onmouseup="this.style.backgroundColor='var(--goglobe-site-bg)'"
                    >
                    Start Chat
                </button>

                <!-- Single Error Message Display -->
                <div id="error-message" class="error-text" style="display:none;"></div>
            </form>
        </div>
    </div>
</div>
<!-- !Sign In -->
{% endblock %}

{% block scripts %}
<script>
// Country data with flags, codes, and names
function initPhoneInput() {
let countries = [
  // North America (NANP - +1)
  { code: '+1', country: 'United States', flag: '🇺🇸', dialCode: '1' },
  { code: '+1', country: 'Canada', flag: '🇨🇦', dialCode: '1' },
  
  // Europe
  { code: '+33', country: 'France', flag: '🇫🇷', dialCode: '33' },
  { code: '+49', country: 'Germany', flag: '🇩🇪', dialCode: '49' },
  { code: '+39', country: 'Italy', flag: '🇮🇹', dialCode: '39' },
  { code: '+34', country: 'Spain', flag: '🇪🇸', dialCode: '34' },
  { code: '+44', country: 'United Kingdom', flag: '🇬🇧', dialCode: '44' },
  { code: '+31', country: 'Netherlands', flag: '🇳🇱', dialCode: '31' },
  { code: '+32', country: 'Belgium', flag: '🇧🇪', dialCode: '32' },
  { code: '+41', country: 'Switzerland', flag: '🇨🇭', dialCode: '41' },
  { code: '+43', country: 'Austria', flag: '🇦🇹', dialCode: '43' },
  { code: '+45', country: 'Denmark', flag: '🇩🇰', dialCode: '45' },
  { code: '+46', country: 'Sweden', flag: '🇸🇪', dialCode: '46' },
  { code: '+47', country: 'Norway', flag: '🇳🇴', dialCode: '47' },
  { code: '+48', country: 'Poland', flag: '🇵🇱', dialCode: '48' },
  { code: '+351', country: 'Portugal', flag: '🇵🇹', dialCode: '351' },
  { code: '+353', country: 'Ireland', flag: '🇮🇪', dialCode: '353' },
  { code: '+354', country: 'Iceland', flag: '🇮🇸', dialCode: '354' },
  { code: '+358', country: 'Finland', flag: '🇫🇮', dialCode: '358' },
  { code: '+36', country: 'Hungary', flag: '🇭🇺', dialCode: '36' },
  { code: '+420', country: 'Czech Republic', flag: '🇨🇿', dialCode: '420' },
  { code: '+421', country: 'Slovakia', flag: '🇸🇰', dialCode: '421' },
  { code: '+386', country: 'Slovenia', flag: '🇸🇮', dialCode: '386' },
  { code: '+385', country: 'Croatia', flag: '🇭🇷', dialCode: '385' },
  { code: '+387', country: 'Bosnia and Herzegovina', flag: '🇧🇦', dialCode: '387' },
  { code: '+381', country: 'Serbia', flag: '🇷🇸', dialCode: '381' },
  { code: '+382', country: 'Montenegro', flag: '🇲🇪', dialCode: '382' },
  { code: '+383', country: 'Kosovo', flag: '🇽🇰', dialCode: '383' },
  { code: '+389', country: 'North Macedonia', flag: '🇲🇰', dialCode: '389' },
  { code: '+355', country: 'Albania', flag: '🇦🇱', dialCode: '355' },
  { code: '+30', country: 'Greece', flag: '🇬🇷', dialCode: '30' },
  { code: '+40', country: 'Romania', flag: '🇷🇴', dialCode: '40' },
  { code: '+359', country: 'Bulgaria', flag: '🇧🇬', dialCode: '359' },
  { code: '+373', country: 'Moldova', flag: '🇲🇩', dialCode: '373' },
  { code: '+380', country: 'Ukraine', flag: '🇺🇦', dialCode: '380' },
  { code: '+375', country: 'Belarus', flag: '🇧🇾', dialCode: '375' },
  { code: '+370', country: 'Lithuania', flag: '🇱🇹', dialCode: '370' },
  { code: '+371', country: 'Latvia', flag: '🇱🇻', dialCode: '371' },
  { code: '+372', country: 'Estonia', flag: '🇪🇪', dialCode: '372' },
  { code: '+7', country: 'Russia', flag: '🇷🇺', dialCode: '7' },
  { code: '+90', country: 'Turkey', flag: '🇹🇷', dialCode: '90' },
  { code: '+357', country: 'Cyprus', flag: '🇨🇾', dialCode: '357' },
  { code: '+356', country: 'Malta', flag: '🇲🇹', dialCode: '356' },
  { code: '+377', country: 'Monaco', flag: '🇲🇨', dialCode: '377' },
  { code: '+378', country: 'San Marino', flag: '🇸🇲', dialCode: '378' },
  { code: '+379', country: 'Vatican City', flag: '🇻🇦', dialCode: '379' },
  { code: '+376', country: 'Andorra', flag: '🇦🇩', dialCode: '376' },
  { code: '+423', country: 'Liechtenstein', flag: '🇱🇮', dialCode: '423' },
  { code: '+298', country: 'Faroe Islands', flag: '🇫🇴', dialCode: '298' },
  
  // Asia
  { code: '+86', country: 'China', flag: '🇨🇳', dialCode: '86' },
  { code: '+91', country: 'India', flag: '🇮🇳', dialCode: '91' },
  { code: '+81', country: 'Japan', flag: '🇯🇵', dialCode: '81' },
  { code: '+82', country: 'South Korea', flag: '🇰🇷', dialCode: '82' },
  { code: '+886', country: 'Taiwan', flag: '🇹🇼', dialCode: '886' },
  { code: '+852', country: 'Hong Kong', flag: '🇭🇰', dialCode: '852' },
  { code: '+853', country: 'Macau', flag: '🇲🇴', dialCode: '853' },
  { code: '+65', country: 'Singapore', flag: '🇸🇬', dialCode: '65' },
  { code: '+60', country: 'Malaysia', flag: '🇲🇾', dialCode: '60' },
  { code: '+66', country: 'Thailand', flag: '🇹🇭', dialCode: '66' },
  { code: '+84', country: 'Vietnam', flag: '🇻🇳', dialCode: '84' },
  { code: '+62', country: 'Indonesia', flag: '🇮🇩', dialCode: '62' },
  { code: '+63', country: 'Philippines', flag: '🇵🇭', dialCode: '63' },
  { code: '+855', country: 'Cambodia', flag: '🇰🇭', dialCode: '855' },
  { code: '+856', country: 'Laos', flag: '🇱🇦', dialCode: '856' },
  { code: '+95', country: 'Myanmar', flag: '🇲🇲', dialCode: '95' },
  { code: '+880', country: 'Bangladesh', flag: '🇧🇩', dialCode: '880' },
  { code: '+94', country: 'Sri Lanka', flag: '🇱🇰', dialCode: '94' },
  { code: '+977', country: 'Nepal', flag: '🇳🇵', dialCode: '977' },
  { code: '+975', country: 'Bhutan', flag: '🇧🇹', dialCode: '975' },
  { code: '+960', country: 'Maldives', flag: '🇲🇻', dialCode: '960' },
  { code: '+92', country: 'Pakistan', flag: '🇵🇰', dialCode: '92' },
  { code: '+93', country: 'Afghanistan', flag: '🇦🇫', dialCode: '93' },
  { code: '+98', country: 'Iran', flag: '🇮🇷', dialCode: '98' },
  { code: '+964', country: 'Iraq', flag: '🇮🇶', dialCode: '964' },
  { code: '+965', country: 'Kuwait', flag: '🇰🇼', dialCode: '965' },
  { code: '+966', country: 'Saudi Arabia', flag: '🇸🇦', dialCode: '966' },
  { code: '+967', country: 'Yemen', flag: '🇾🇪', dialCode: '967' },
  { code: '+968', country: 'Oman', flag: '🇴🇲', dialCode: '968' },
  { code: '+971', country: 'UAE', flag: '🇦🇪', dialCode: '971' },
  { code: '+973', country: 'Bahrain', flag: '🇧🇭', dialCode: '973' },
  { code: '+974', country: 'Qatar', flag: '🇶🇦', dialCode: '974' },
  { code: '+970', country: 'Palestine', flag: '🇵🇸', dialCode: '970' },
  { code: '+972', country: 'Israel', flag: '🇮🇱', dialCode: '972' },
  { code: '+961', country: 'Lebanon', flag: '🇱🇧', dialCode: '961' },
  { code: '+963', country: 'Syria', flag: '🇸🇾', dialCode: '963' },
  { code: '+962', country: 'Jordan', flag: '🇯🇴', dialCode: '962' },
  { code: '+996', country: 'Kyrgyzstan', flag: '🇰🇬', dialCode: '996' },
  { code: '+998', country: 'Uzbekistan', flag: '🇺🇿', dialCode: '998' },
  { code: '+992', country: 'Tajikistan', flag: '🇹🇯', dialCode: '992' },
  { code: '+993', country: 'Turkmenistan', flag: '🇹🇲', dialCode: '993' },
  { code: '+7', country: 'Kazakhstan', flag: '🇰🇿', dialCode: '7' },
  { code: '+976', country: 'Mongolia', flag: '🇲🇳', dialCode: '976' },
  { code: '+850', country: 'North Korea', flag: '🇰🇵', dialCode: '850' },
  
  // Africa
  { code: '+20', country: 'Egypt', flag: '🇪🇬', dialCode: '20' },
  { code: '+27', country: 'South Africa', flag: '🇿🇦', dialCode: '27' },
  { code: '+234', country: 'Nigeria', flag: '🇳🇬', dialCode: '234' },
  { code: '+251', country: 'Ethiopia', flag: '🇪🇹', dialCode: '251' },
  { code: '+254', country: 'Kenya', flag: '🇰🇪', dialCode: '254' },
  { code: '+255', country: 'Tanzania', flag: '🇹🇿', dialCode: '255' },
  { code: '+256', country: 'Uganda', flag: '🇺🇬', dialCode: '256' },
  { code: '+250', country: 'Rwanda', flag: '🇷🇼', dialCode: '250' },
  { code: '+257', country: 'Burundi', flag: '🇧🇮', dialCode: '257' },
  { code: '+243', country: 'DR Congo', flag: '🇨🇩', dialCode: '243' },
  { code: '+242', country: 'Republic of Congo', flag: '🇨🇬', dialCode: '242' },
  { code: '+237', country: 'Cameroon', flag: '🇨🇲', dialCode: '237' },
  { code: '+236', country: 'Central African Republic', flag: '🇨🇫', dialCode: '236' },
  { code: '+235', country: 'Chad', flag: '🇹🇩', dialCode: '235' },
  { code: '+249', country: 'Sudan', flag: '🇸🇩', dialCode: '249' },
  { code: '+211', country: 'South Sudan', flag: '🇸🇸', dialCode: '211' },
  { code: '+216', country: 'Tunisia', flag: '🇹🇳', dialCode: '216' },
  { code: '+213', country: 'Algeria', flag: '🇩🇿', dialCode: '213' },
  { code: '+212', country: 'Morocco', flag: '🇲🇦', dialCode: '212' },
  { code: '+218', country: 'Libya', flag: '🇱🇾', dialCode: '218' },
  { code: '+233', country: 'Ghana', flag: '🇬🇭', dialCode: '233' },
  { code: '+225', country: 'Ivory Coast', flag: '🇨🇮', dialCode: '225' },
  { code: '+226', country: 'Burkina Faso', flag: '🇧🇫', dialCode: '226' },
  { code: '+223', country: 'Mali', flag: '🇲🇱', dialCode: '223' },
  { code: '+222', country: 'Mauritania', flag: '🇲🇷', dialCode: '222' },
  { code: '+221', country: 'Senegal', flag: '🇸🇳', dialCode: '221' },
  { code: '+220', country: 'Gambia', flag: '🇬🇲', dialCode: '220' },
  { code: '+224', country: 'Guinea', flag: '🇬🇳', dialCode: '224' },
  { code: '+245', country: 'Guinea-Bissau', flag: '🇬🇼', dialCode: '245' },
  { code: '+238', country: 'Cape Verde', flag: '🇨🇻', dialCode: '238' },
  { code: '+232', country: 'Sierra Leone', flag: '🇸🇱', dialCode: '232' },
  { code: '+231', country: 'Liberia', flag: '🇱🇷', dialCode: '231' },
  { code: '+228', country: 'Togo', flag: '🇹🇬', dialCode: '228' },
  { code: '+229', country: 'Benin', flag: '🇧🇯', dialCode: '229' },
  { code: '+227', country: 'Niger', flag: '🇳🇪', dialCode: '227' },
  { code: '+230', country: 'Mauritius', flag: '🇲🇺', dialCode: '230' },
  { code: '+248', country: 'Seychelles', flag: '🇸🇨', dialCode: '248' },
  { code: '+261', country: 'Madagascar', flag: '🇲🇬', dialCode: '261' },
  { code: '+269', country: 'Comoros', flag: '🇰🇲', dialCode: '269' },
  { code: '+258', country: 'Mozambique', flag: '🇲🇿', dialCode: '258' },
  { code: '+260', country: 'Zambia', flag: '🇿🇲', dialCode: '260' },
  { code: '+263', country: 'Zimbabwe', flag: '🇿🇼', dialCode: '263' },
  { code: '+267', country: 'Botswana', flag: '🇧🇼', dialCode: '267' },
  { code: '+264', country: 'Namibia', flag: '🇳🇦', dialCode: '264' },
  { code: '+268', country: 'Eswatini', flag: '🇸🇿', dialCode: '268' },
  { code: '+266', country: 'Lesotho', flag: '🇱🇸', dialCode: '266' },
  { code: '+240', country: 'Equatorial Guinea', flag: '🇬🇶', dialCode: '240' },
  { code: '+239', country: 'São Tomé and Príncipe', flag: '🇸🇹', dialCode: '239' },
  { code: '+244', country: 'Angola', flag: '🇦🇴', dialCode: '244' },
  { code: '+253', country: 'Djibouti', flag: '🇩🇯', dialCode: '253' },
  { code: '+252', country: 'Somalia', flag: '🇸🇴', dialCode: '252' },
  { code: '+291', country: 'Eritrea', flag: '🇪🇷', dialCode: '291' },
  
  // Oceania
  { code: '+61', country: 'Australia', flag: '🇦🇺', dialCode: '61' },
  { code: '+64', country: 'New Zealand', flag: '🇳🇿', dialCode: '64' },
  { code: '+679', country: 'Fiji', flag: '🇫🇯', dialCode: '679' },
  { code: '+676', country: 'Tonga', flag: '🇹🇴', dialCode: '676' },
  { code: '+685', country: 'Samoa', flag: '🇼🇸', dialCode: '685' },
  { code: '+684', country: 'American Samoa', flag: '🇦🇸', dialCode: '684' },
  { code: '+686', country: 'Kiribati', flag: '🇰🇮', dialCode: '686' },
  { code: '+687', country: 'New Caledonia', flag: '🇳🇨', dialCode: '687' },
  { code: '+689', country: 'French Polynesia', flag: '🇵🇫', dialCode: '689' },
  { code: '+690', country: 'Tokelau', flag: '🇹🇰', dialCode: '690' },
  { code: '+691', country: 'Micronesia', flag: '🇫🇲', dialCode: '691' },
  { code: '+692', country: 'Marshall Islands', flag: '🇲🇭', dialCode: '692' },
  { code: '+680', country: 'Palau', flag: '🇵🇼', dialCode: '680' },
  { code: '+675', country: 'Papua New Guinea', flag: '🇵🇬', dialCode: '675' },
  { code: '+677', country: 'Solomon Islands', flag: '🇸🇧', dialCode: '677' },
  { code: '+678', country: 'Vanuatu', flag: '🇻🇺', dialCode: '678' },
  { code: '+683', country: 'Niue', flag: '🇳🇺', dialCode: '683' },
  { code: '+682', country: 'Cook Islands', flag: '🇨🇰', dialCode: '682' },
  { code: '+688', country: 'Tuvalu', flag: '🇹🇻', dialCode: '688' },
  { code: '+674', country: 'Nauru', flag: '🇳🇷', dialCode: '674' },
  
  // South America
  { code: '+55', country: 'Brazil', flag: '🇧🇷', dialCode: '55' },
  { code: '+54', country: 'Argentina', flag: '🇦🇷', dialCode: '54' },
  { code: '+56', country: 'Chile', flag: '🇨🇱', dialCode: '56' },
  { code: '+57', country: 'Colombia', flag: '🇨🇴', dialCode: '57' },
  { code: '+58', country: 'Venezuela', flag: '🇻🇪', dialCode: '58' },
  { code: '+51', country: 'Peru', flag: '🇵🇪', dialCode: '51' },
  { code: '+593', country: 'Ecuador', flag: '🇪🇨', dialCode: '593' },
  { code: '+591', country: 'Bolivia', flag: '🇧🇴', dialCode: '591' },
  { code: '+595', country: 'Paraguay', flag: '🇵🇾', dialCode: '595' },
  { code: '+598', country: 'Uruguay', flag: '🇺🇾', dialCode: '598' },
  { code: '+597', country: 'Suriname', flag: '🇸🇷', dialCode: '597' },
  { code: '+594', country: 'French Guiana', flag: '🇬🇫', dialCode: '594' },
  { code: '+592', country: 'Guyana', flag: '🇬🇾', dialCode: '592' },
  
  // Central America & Caribbean
  { code: '+52', country: 'Mexico', flag: '🇲🇽', dialCode: '52' },
  { code: '+502', country: 'Guatemala', flag: '🇬🇹', dialCode: '502' },
  { code: '+503', country: 'El Salvador', flag: '🇸🇻', dialCode: '503' },
  { code: '+504', country: 'Honduras', flag: '🇭🇳', dialCode: '504' },
  { code: '+505', country: 'Nicaragua', flag: '🇳🇮', dialCode: '505' },
  { code: '+506', country: 'Costa Rica', flag: '🇨🇷', dialCode: '506' },
  { code: '+507', country: 'Panama', flag: '🇵🇦', dialCode: '507' },
  { code: '+501', country: 'Belize', flag: '🇧🇿', dialCode: '501' },
  { code: '+53', country: 'Cuba', flag: '🇨🇺', dialCode: '53' },
  { code: '+509', country: 'Haiti', flag: '🇭🇹', dialCode: '509' },
  { code: '+590', country: 'Guadeloupe', flag: '🇬🇵', dialCode: '590' },
  { code: '+596', country: 'Martinique', flag: '🇲🇶', dialCode: '596' },
  { code: '+599', country: 'Curaçao', flag: '🇨🇼', dialCode: '599' },
  { code: '+297', country: 'Aruba', flag: '🇦🇼', dialCode: '297' },
  { code: '+1787', country: 'Puerto Rico', flag: '🇵🇷', dialCode: '1787' },
  { code: '+1809', country: 'Dominican Republic', flag: '🇩🇴', dialCode: '1809' },
  { code: '+1876', country: 'Jamaica', flag: '🇯🇲', dialCode: '1876' },
  { code: '+1658', country: 'Jamaica', flag: '🇯🇲', dialCode: '1658' },
  { code: '+1868', country: 'Trinidad and Tobago', flag: '🇹🇹', dialCode: '1868' },
  { code: '+1246', country: 'Barbados', flag: '🇧🇧', dialCode: '1246' },
  { code: '+1242', country: 'Bahamas', flag: '🇧🇸', dialCode: '1242' },
  
  // Special Territories & Other
  { code: '+500', country: 'Falkland Islands', flag: '🇫🇰', dialCode: '500' },
  { code: '+290', country: 'Saint Helena', flag: '🇸🇭', dialCode: '290' },
  { code: '+246', country: 'British Indian Ocean Territory', flag: '🇮🇴', dialCode: '246' },
  { code: '+672', country: 'Antarctica', flag: '🇦🇶', dialCode: '672' },
  { code: '+299', country: 'Greenland', flag: '🇬🇱', dialCode: '299' },
  { code: '+508', country: 'Saint Pierre and Miquelon', flag: '🇵🇲', dialCode: '508' }
];

countries.sort((a, b) => Number(a.dialCode) - Number(b.dialCode));
    let countrySelector = document.getElementById('country-selector');
    let phoneInput = document.getElementById('phone');
    
    // Set default country based on Flask variable
    let userCountryCode = '{{ user_country if user_country else "United State" }}';
    let defaultCountry = countries.find(c => c.country === userCountryCode) || countries.find(c => c.dialCode === '1');
    
    // Populate dropdown options
    function populateDropdown() {
        countrySelector.innerHTML = '';
        countries.forEach(country => {
            let option = document.createElement('option');
            option.value = country.code;
            option.textContent = `${country.flag} ${country.code}`;
            option.dataset.dialCode = country.dialCode;
            
            if (country.dialCode === defaultCountry.dialCode) {
                option.selected = true;
            }
            
            countrySelector.appendChild(option);
        });
    }
    
    // Handle phone input changes
    phoneInput.addEventListener('input', function() {
        // Only allow digits, spaces, hyphens, and parentheses
        this.value = this.value.replace(/[^\d\s\-()]/g, '');
    });
    
    // Initialize
    populateDropdown();
    
    return defaultCountry;
}

function initForm() {
    let loginForm = document.getElementById("login-form");
    let nameInput = document.getElementById("name");
    let emailInput = document.getElementById("email");
    let subjectInput = document.getElementById("subject");
    let desgInput = document.getElementById("desg");
    let phoneInput = document.getElementById("phone");
    let phoneContainer = document.getElementById("phone-container");
    let errorMessage = document.getElementById("error-message");

    // Initialize phone input
    let currentCountry = initPhoneInput();

    // Validation regex patterns
    let emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    let phoneRegex = /^[\d\s\-()]{7,15}$/;

    // Unified error display function
    function showError(message) {
        errorMessage.textContent = message;
        errorMessage.style.display = "block";
    }

    function hideError() {
        errorMessage.textContent = "";
        errorMessage.style.display = "none";
    }

    // Remove error styling from all inputs
    function clearErrorStyling() {
        nameInput.classList.remove("input-error");
        emailInput.classList.remove("input-error");
        phoneContainer.classList.remove("input-error");
        subjectInput.classList.remove("input-error");
        if (desgInput) {
            desgInput.classList.remove("input-error");
        }
    }

    // Form validation function
    function validateForm() {
        hideError();
        clearErrorStyling();

        // Validate name
        if (!nameInput.value.trim()) {
            nameInput.classList.add("input-error");
            showError("Name is required");
            return false;
        }
        if (nameInput.value.trim().length < 2) {
            nameInput.classList.add("input-error");
            showError("Name must be at least 2 characters");
            return false;
        }

        // Validate email
        if (!emailInput.value.trim()) {
            emailInput.classList.add("input-error");
            showError("Email is required");
            return false;
        }
        if (!emailRegex.test(emailInput.value.trim())) {
            emailInput.classList.add("input-error");
            showError("Please enter a valid email address");
            return false;
        }

        // Validate subject
        if (!subjectInput.value.trim()) {
            subjectInput.classList.add("input-error");
            showError("Subject is required");
            return false;
        }

        // Validate designation (if exists)
        if (desgInput && !desgInput.value.trim()) {
            desgInput.classList.add("input-error");
            showError("Designation is required");
            return false;
        }

        // Validate phone
        if (!phoneInput.value.trim()) {
            phoneContainer.classList.add("input-error");
            showError("Phone number is required");
            return false;
        }
        if (!phoneRegex.test(phoneInput.value.trim())) {
            phoneContainer.classList.add("input-error");
            showError("Please enter a valid phone number (7-15 digits)");
            return false;
        }

        return true;
    }

    // Form submission
    loginForm.addEventListener("submit", function (e) {
        e.preventDefault();

        if (!validateForm()) {
            return;
        }

        // Update current country before submission
        currentCountry = document.getElementById('country-selector').value;

        let name = nameInput.value.trim();
        let email = emailInput.value.trim();
        let phone = currentCountry + phoneInput.value.trim().replace(/\D/g, ''); 
        let subject = subjectInput.value.trim();
        let desg = desgInput ? desgInput.value.trim() : "None";
        let isHtmxRequest = document.getElementById("chatbox") !== null;
        
        fetch("{{settings['backend_url']}}/min/auth", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "HX-Request": isHtmxRequest
            },
            credentials: "include",
            body: JSON.stringify({
                name: name,
                email: email,
                phone: phone,
                subject: subject,
                desg: desg
            }),
        })
        .then(async (response) => {
            if (!response.ok) {
                let data = await response.json();
                showError(data.error || "Login failed");
                return;
            }

            if (isHtmxRequest) {
                let text = await response.text();
                htmx.swap('#chatbox', text, {swapStyle: 'innerHTML'});
            } else {
                if (response.redirected) {
                    window.location.href = response.url;
                } else {
                    let text = await response.text();
                }
            }
        })
        .catch((error) => {
            console.error("Error:", error);
            showError("An error occurred. Please try again.");
        });
    });

    // Real-time validation clearing
    [nameInput, emailInput, phoneInput, subjectInput, desgInput].forEach(input => {
        if (input) {
            input.addEventListener("input", function () {
                hideError();
                clearErrorStyling();
            });
        }
    });
}

function showReturnChatButton() {
    let returnButton = document.getElementById('return-chat');
    if (returnButton) {
        returnButton.style.display = 'block';
        
        // Make sure HTMX processes the button
        if (typeof htmx !== 'undefined') {
            htmx.process(returnButton);
        }
    }
}

// Initialize the form when the DOM is fully loaded
document.addEventListener('DOMContentLoaded', function() {
    showReturnChatButton();
    initForm();
});

// Also call it immediately in case the script loads after DOM is ready
showReturnChatButton();
initForm();
</script>
{% endblock %}
