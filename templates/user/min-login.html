{% extends 'user/base-min.html' %} {% block content %}
<!-- Sign In -->
<style>
  /* Simple styling for form validation */
  input:invalid, select:invalid {
    border-color: #ef4444;
  }
  input::placeholder{
    color:gray;
  }
  
  /* Error message styling */
  .error-text {
    color: #ef4444;
    font-size: 0.875rem;
    margin-top: 20px;
    margin-bottom: 10px;
    border-radius: 6px;
    position: relative;
  }
  
  
  .input-error {
    border: 1px solid #ef4444 !important;
    box-shadow: 0 0 0 1px #ef4444 !important;
  }

  /* Phone input container styling */
  .phone-input-container {
    display: flex;
    align-items: center;
    border: 1px solid var(--goglobe-site-bg-color);
    border-radius: 6px;
    background-color: var(--goglobe-input-color);
    transition: all 0.2s;
    overflow: hidden;
  }

  .phone-input-container:focus-within {
    border-color: var(--goglobe-main-color);
  }
</style>

<div style="display:flex; flex-direction:row;gap:15px; margin-bottom:20px;">
<svg width="60" height="63" viewBox="0 0 60 63" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M34.9837 2.98219C20.5215 0.285021 6.57007 9.60674 3.90138 23.9148C1.2329 38.2232 10.8863 51.9479 25.3487 54.6451L52.7215 59.7501L51.3281 55.6944L48.652 47.8958C52.6893 44.1138 55.4226 39.1538 56.4308 33.7085C59.0971 19.4014 49.4448 5.67934 34.9837 2.98219Z" fill="white" stroke="#FF5800" stroke-width="5"/>
  <path d="M16.9164 28.0168V41.5406H43.5975L43.474 28.0168L42.2 21.4509L19.1704 22.7249L16.9164 28.0168Z" fill="#F7D5B1"/>
  <path d="M11.2325 17.1385L16.9164 28.0164L19.1703 22.7244L42.1999 21.4505L43.4739 28.0164L46.3159 18.2165L40.142 16.9425L42.1019 13.8066L38.721 14.2476L42.1509 9.54366L35.0951 12.7776L38.525 5.91772L28.1372 12.4836L27.1572 9.73966L11.2325 17.1385Z" fill="#52504D"/>
  <path d="M16.9413 41.3388V47.0213H43.2018V41.3125L16.9413 41.3388Z" fill="white"/>
  <path d="M19.6604 41.4421L30.2442 52.026L40.7301 41.4421H19.6604Z" fill="#E8EAEB"/>
  <path d="M20.3463 41.4421L24.1683 45.9501L30.1462 41.5401L36.2221 45.9501L40.044 41.4421H20.3463Z" fill="white"/>
  <path d="M30.1462 41.5403L28.0882 43.0103V43.5003H32.4002V43.0103L30.1462 41.5403Z" fill="#C95C1C"/>
  <path d="M30.0715 51.5885H33.4968L32.4001 43.5002H28.0882L27.2171 51.5885H30.0715Z" fill="#FF5E00"/>
  <path d="M30.3975 37.0812C32.3947 37.0812 34.2857 35.0523 34.0847 34.1945C33.8838 33.3367 32.3947 34.1945 30.3975 34.1945C28.4002 34.1945 26.9525 33.1927 26.852 34.1945C26.7516 35.1964 28.3588 36.9372 30.3975 37.0812Z" fill="#3B3731"/>
  <path d="M22.6335 29.1925C23.283 29.1925 23.8095 28.666 23.8095 28.0166C23.8095 27.3671 23.283 26.8406 22.6335 26.8406C21.9841 26.8406 21.4576 27.3671 21.4576 28.0166C21.4576 28.666 21.9841 29.1925 22.6335 29.1925Z" fill="#3B3731"/>
  <path d="M37.6275 29.1925C38.277 29.1925 38.8035 28.666 38.8035 28.0166C38.8035 27.3671 38.277 26.8406 37.6275 26.8406C36.978 26.8406 36.4515 27.3671 36.4515 28.0166C36.4515 28.666 36.978 29.1925 37.6275 29.1925Z" fill="#3B3731"/>
  <path d="M16.9164 28.0168V41.5406H43.5975L43.474 28.0168L42.2 21.4509L19.1704 22.7249L16.9164 28.0168Z" fill="#F7D5B1"/>
  <path d="M11.2325 17.1385L16.9164 28.0164L19.1703 22.7244L42.1999 21.4505L43.4739 28.0164L46.3159 18.2165L40.142 16.9425L42.1019 13.8066L38.721 14.2476L42.1509 9.54366L35.0951 12.7776L38.525 5.91772L28.1372 12.4836L27.1572 9.73966L11.2325 17.1385Z" fill="#52504D"/>
  <path d="M16.9413 41.3388V47.0213H43.2018V41.3125L16.9413 41.3388Z" fill="white"/>
  <path d="M19.6604 41.4421L30.2442 52.026L40.7301 41.4421H19.6604Z" fill="#E8EAEB"/>
  <path d="M20.3463 41.4421L24.1683 45.9501L30.1462 41.5401L36.2221 45.9501L40.044 41.4421H20.3463Z" fill="white"/>
  <path d="M30.1462 41.5403L28.0882 43.0103V43.5003H32.4002V43.0103L30.1462 41.5403Z" fill="#C95C1C"/>
  <path d="M30.0715 51.5885H33.4968L32.4001 43.5002H28.0882L27.2171 51.5885H30.0715Z" fill="#FF5E00"/>
  <path d="M30.3975 37.0812C32.3947 37.0812 34.2857 35.0523 34.0847 34.1945C33.8838 33.3367 32.3947 34.1945 30.3975 34.1945C28.4002 34.1945 26.9525 33.1927 26.852 34.1945C26.7516 35.1964 28.3588 36.9372 30.3975 37.0812Z" fill="#3B3731"/>
  <path d="M22.6335 29.1925C23.283 29.1925 23.8095 28.666 23.8095 28.0166C23.8095 27.3671 23.283 26.8406 22.6335 26.8406C21.9841 26.8406 21.4576 27.3671 21.4576 28.0166C21.4576 28.666 21.9841 29.1925 22.6335 29.1925Z" fill="#3B3731"/>
  <path d="M37.6275 29.1925C38.277 29.1925 38.8035 28.666 38.8035 28.0166C38.8035 27.3671 38.277 26.8406 37.6275 26.8406C36.978 26.8406 36.4515 27.3671 36.4515 28.0166C36.4515 28.666 36.978 29.1925 37.6275 29.1925Z" fill="#3B3731"/>
</svg>

    <p style="color: #FFF; font-size: 16px; font-style: normal; font-weight: 400; line-height: 20px; letter-spacing: -0.32px;">
        Let us know about you!
    </p>
</div>

<div style="overflow-y:hidden; background-color: var(--goglobe-site-bg-color); color: var(--goglobe-body-color); font-family: var(--goglobe-body-font-family); width: 100%;">
    <!-- Desktop logo would go here -->
    <div style="border-radius: 0.5rem; padding: 0.5rem; margin: 0 auto;">
        <div style="margin-bottom: 2rem;">
            <form id="login-form" novalidate>
                <div style="margin-bottom: 1rem; width: 100%;">
                    <input type="text"
                        style="font-family: var(--goglobe-body-font-family); width: 100%; border-radius: 6px; outline: none; border: 1px solid var(--goglobe-site-bg-color); padding: 12px; color: white; font-weight: bold; transition: all 0.2s; background-color: var(--goglobe-input-color); box-sizing: border-box;"
                        class='placeholder-[var(--goglobe-body-color)] placeholder-bold'
                        id="name" name="name" placeholder="Your Name*" autocapitalize="off"
                        autocomplete="name" required minlength="2"
                        onfocus="this.style.border = '1px solid var(--goglobe-main-color)';"
                        onblur="this.style.border = '1px solid var(--goglobe-site-bg-color)';">
                </div>

                {% if default_subject.lower() != "job" %}
                <div style="margin-bottom: 1rem; width: 100%;">
                    <input type="text"
                        style="font-family: var(--goglobe-body-font-family); width: 100%; border-radius: 6px; outline: none; border: 1px solid var(--goglobe-site-bg-color); padding: 12px; color: white; font-weight: bold; transition: all 0.2s; background-color: var(--goglobe-input-color); box-sizing: border-box;"
                        class='placeholder-[var(--goglobe-body-color)] placeholder-bold'
                        id="desg" name="desg" placeholder="Designation*" autocapitalize="off"
                        onfocus="this.style.border = '1px solid var(--goglobe-main-color)';"
                        onblur="this.style.border = '1px solid var(--goglobe-site-bg-color)';">
                </div>
                {% endif %}

                <div style="margin-bottom: 1rem; width: 100%;">
                    <input type="email"
                        style="font-family: var(--goglobe-body-font-family); width: 100%; border-radius: 6px; outline: none; border: 1px solid var(--goglobe-site-bg-color); padding: 12px; color: white; font-weight: bold; transition: all 0.2s; background-color: var(--goglobe-input-color); box-sizing: border-box;"
                        class='placeholder-[var(--goglobe-body-color)] placeholder-bold'
                        id="email" name="email" placeholder="Email Address*" autocapitalize="off"
                        autocomplete="email" required pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                        onfocus="this.style.border = '1px solid var(--goglobe-main-color)';"
                        onblur="this.style.border = '1px solid var(--goglobe-site-bg-color)';">
                </div>

                <div style="margin-bottom: 1rem; width: 100%;" class="hidden">
                    <select
                        style="font-family: var(--goglobe-body-font-family); width: 100%; border-radius: 6px; outline: none; border: 1px solid var(--goglobe-site-bg-color); padding: 12px; color: white; font-weight: bold; transition: all 0.2s; background-color: var(--goglobe-input-color); box-sizing: border-box;"
                        class='placeholder-[var(--goglobe-body-color)] placeholder-bold'
                        id="subject" name="subject" autocapitalize="off" autocomplete="off" required
                        onfocus="this.style.border = '1px solid var(--goglobe-main-color)';"
                        onblur="this.style.border = '1px solid var(--goglobe-site-bg-color)';">
                        {% for subject in settings['subjects'] %}
                        <option {% if default_subject and default_subject==subject %} selected='true' {% endif %}>
                            {{subject}}</option>
                        {% endfor %}
                    </select>
                </div>

                <!-- Enhanced Phone Input -->
                <div style="margin-bottom: 1.5rem; width: 100%;">
                    <div class="phone-input-container" id="phone-container" style="width: 100%;">
                        <select class="country-selector" id="country-selector" name="country-code" style="font-family: var(--goglobe-body-font-family); padding: 12px; background: transparent; border: none; color: white; font-weight: bold; cursor: pointer; outline: none; width: 30%;">
                            <!-- Countries will be populated by JavaScript -->
                        </select>
                        <input type="tel" 
                            class="phone-number-input placeholder-[var(--goglobe-body-color)] placeholder-bold"
                            style="font-family: var(--goglobe-body-font-family); flex: 1; border: none; outline: none; background: transparent; color: white; font-weight: bold; padding: 12px; width: 70%;"
                            id="phone" 
                            name="phone" 
                            placeholder="Phone Number*" 
                            autocomplete="tel" 
                            required>
                    </div>
                </div>

                <button type="submit" id="login-btn"
                    style=" box-sizing: border-box;font-family: var(--goglobe-body-font-family); font-weight:bold; color:white; padding: 0.75rem 1rem; background-color: var(--goglobe-main-color); border: 1px solid var(--goglobe-border-color); border-radius: 6px; transition: all 0.3s;"
                    onmouseover="this.style.backgroundColor='var(--goglobe-site-bg)'; this.style.cursor='pointer'"
                    onmouseout="this.style.backgroundColor='var(--goglobe-main-color)'; this.style.cursor='auto'"
                    onmousedown="this.style.backgroundColor='var(--goglobe-site-bg)'"
                    onmouseup="this.style.backgroundColor='var(--goglobe-site-bg)'">
                    Start Chat
                </button>

                <!-- Single Error Message Display -->
                <div id="error-message" class="error-text" style="display:none;"></div>
            </form>
        </div>
    </div>
</div>
<!-- !Sign In -->
{% endblock %}

{% block scripts %}
<script>
// Country data with flags, codes, and names
function initPhoneInput() {
let countries = [
  // North America (NANP - +1)
  { code: '+1', country: 'United States', flag: 'ðŸ‡ºðŸ‡¸', dialCode: '1' },
  { code: '+1', country: 'Canada', flag: 'ðŸ‡¨ðŸ‡¦', dialCode: '1' },
  
  // Europe
  { code: '+33', country: 'France', flag: 'ðŸ‡«ðŸ‡·', dialCode: '33' },
  { code: '+49', country: 'Germany', flag: 'ðŸ‡©ðŸ‡ª', dialCode: '49' },
  { code: '+39', country: 'Italy', flag: 'ðŸ‡®ðŸ‡¹', dialCode: '39' },
  { code: '+34', country: 'Spain', flag: 'ðŸ‡ªðŸ‡¸', dialCode: '34' },
  { code: '+44', country: 'United Kingdom', flag: 'ðŸ‡¬ðŸ‡§', dialCode: '44' },
  { code: '+31', country: 'Netherlands', flag: 'ðŸ‡³ðŸ‡±', dialCode: '31' },
  { code: '+32', country: 'Belgium', flag: 'ðŸ‡§ðŸ‡ª', dialCode: '32' },
  { code: '+41', country: 'Switzerland', flag: 'ðŸ‡¨ðŸ‡­', dialCode: '41' },
  { code: '+43', country: 'Austria', flag: 'ðŸ‡¦ðŸ‡¹', dialCode: '43' },
  { code: '+45', country: 'Denmark', flag: 'ðŸ‡©ðŸ‡°', dialCode: '45' },
  { code: '+46', country: 'Sweden', flag: 'ðŸ‡¸ðŸ‡ª', dialCode: '46' },
  { code: '+47', country: 'Norway', flag: 'ðŸ‡³ðŸ‡´', dialCode: '47' },
  { code: '+48', country: 'Poland', flag: 'ðŸ‡µðŸ‡±', dialCode: '48' },
  { code: '+351', country: 'Portugal', flag: 'ðŸ‡µðŸ‡¹', dialCode: '351' },
  { code: '+353', country: 'Ireland', flag: 'ðŸ‡®ðŸ‡ª', dialCode: '353' },
  { code: '+354', country: 'Iceland', flag: 'ðŸ‡®ðŸ‡¸', dialCode: '354' },
  { code: '+358', country: 'Finland', flag: 'ðŸ‡«ðŸ‡®', dialCode: '358' },
  { code: '+36', country: 'Hungary', flag: 'ðŸ‡­ðŸ‡º', dialCode: '36' },
  { code: '+420', country: 'Czech Republic', flag: 'ðŸ‡¨ðŸ‡¿', dialCode: '420' },
  { code: '+421', country: 'Slovakia', flag: 'ðŸ‡¸ðŸ‡°', dialCode: '421' },
  { code: '+386', country: 'Slovenia', flag: 'ðŸ‡¸ðŸ‡®', dialCode: '386' },
  { code: '+385', country: 'Croatia', flag: 'ðŸ‡­ðŸ‡·', dialCode: '385' },
  { code: '+387', country: 'Bosnia and Herzegovina', flag: 'ðŸ‡§ðŸ‡¦', dialCode: '387' },
  { code: '+381', country: 'Serbia', flag: 'ðŸ‡·ðŸ‡¸', dialCode: '381' },
  { code: '+382', country: 'Montenegro', flag: 'ðŸ‡²ðŸ‡ª', dialCode: '382' },
  { code: '+383', country: 'Kosovo', flag: 'ðŸ‡½ðŸ‡°', dialCode: '383' },
  { code: '+389', country: 'North Macedonia', flag: 'ðŸ‡²ðŸ‡°', dialCode: '389' },
  { code: '+355', country: 'Albania', flag: 'ðŸ‡¦ðŸ‡±', dialCode: '355' },
  { code: '+30', country: 'Greece', flag: 'ðŸ‡¬ðŸ‡·', dialCode: '30' },
  { code: '+40', country: 'Romania', flag: 'ðŸ‡·ðŸ‡´', dialCode: '40' },
  { code: '+359', country: 'Bulgaria', flag: 'ðŸ‡§ðŸ‡¬', dialCode: '359' },
  { code: '+373', country: 'Moldova', flag: 'ðŸ‡²ðŸ‡©', dialCode: '373' },
  { code: '+380', country: 'Ukraine', flag: 'ðŸ‡ºðŸ‡¦', dialCode: '380' },
  { code: '+375', country: 'Belarus', flag: 'ðŸ‡§ðŸ‡¾', dialCode: '375' },
  { code: '+370', country: 'Lithuania', flag: 'ðŸ‡±ðŸ‡¹', dialCode: '370' },
  { code: '+371', country: 'Latvia', flag: 'ðŸ‡±ðŸ‡»', dialCode: '371' },
  { code: '+372', country: 'Estonia', flag: 'ðŸ‡ªðŸ‡ª', dialCode: '372' },
  { code: '+7', country: 'Russia', flag: 'ðŸ‡·ðŸ‡º', dialCode: '7' },
  { code: '+90', country: 'Turkey', flag: 'ðŸ‡¹ðŸ‡·', dialCode: '90' },
  { code: '+357', country: 'Cyprus', flag: 'ðŸ‡¨ðŸ‡¾', dialCode: '357' },
  { code: '+356', country: 'Malta', flag: 'ðŸ‡²ðŸ‡¹', dialCode: '356' },
  { code: '+377', country: 'Monaco', flag: 'ðŸ‡²ðŸ‡¨', dialCode: '377' },
  { code: '+378', country: 'San Marino', flag: 'ðŸ‡¸ðŸ‡²', dialCode: '378' },
  { code: '+379', country: 'Vatican City', flag: 'ðŸ‡»ðŸ‡¦', dialCode: '379' },
  { code: '+376', country: 'Andorra', flag: 'ðŸ‡¦ðŸ‡©', dialCode: '376' },
  { code: '+423', country: 'Liechtenstein', flag: 'ðŸ‡±ðŸ‡®', dialCode: '423' },
  { code: '+298', country: 'Faroe Islands', flag: 'ðŸ‡«ðŸ‡´', dialCode: '298' },
  
  // Asia
  { code: '+86', country: 'China', flag: 'ðŸ‡¨ðŸ‡³', dialCode: '86' },
  { code: '+91', country: 'India', flag: 'ðŸ‡®ðŸ‡³', dialCode: '91' },
  { code: '+81', country: 'Japan', flag: 'ðŸ‡¯ðŸ‡µ', dialCode: '81' },
  { code: '+82', country: 'South Korea', flag: 'ðŸ‡°ðŸ‡·', dialCode: '82' },
  { code: '+886', country: 'Taiwan', flag: 'ðŸ‡¹ðŸ‡¼', dialCode: '886' },
  { code: '+852', country: 'Hong Kong', flag: 'ðŸ‡­ðŸ‡°', dialCode: '852' },
  { code: '+853', country: 'Macau', flag: 'ðŸ‡²ðŸ‡´', dialCode: '853' },
  { code: '+65', country: 'Singapore', flag: 'ðŸ‡¸ðŸ‡¬', dialCode: '65' },
  { code: '+60', country: 'Malaysia', flag: 'ðŸ‡²ðŸ‡¾', dialCode: '60' },
  { code: '+66', country: 'Thailand', flag: 'ðŸ‡¹ðŸ‡­', dialCode: '66' },
  { code: '+84', country: 'Vietnam', flag: 'ðŸ‡»ðŸ‡³', dialCode: '84' },
  { code: '+62', country: 'Indonesia', flag: 'ðŸ‡®ðŸ‡©', dialCode: '62' },
  { code: '+63', country: 'Philippines', flag: 'ðŸ‡µðŸ‡­', dialCode: '63' },
  { code: '+855', country: 'Cambodia', flag: 'ðŸ‡°ðŸ‡­', dialCode: '855' },
  { code: '+856', country: 'Laos', flag: 'ðŸ‡±ðŸ‡¦', dialCode: '856' },
  { code: '+95', country: 'Myanmar', flag: 'ðŸ‡²ðŸ‡²', dialCode: '95' },
  { code: '+880', country: 'Bangladesh', flag: 'ðŸ‡§ðŸ‡©', dialCode: '880' },
  { code: '+94', country: 'Sri Lanka', flag: 'ðŸ‡±ðŸ‡°', dialCode: '94' },
  { code: '+977', country: 'Nepal', flag: 'ðŸ‡³ðŸ‡µ', dialCode: '977' },
  { code: '+975', country: 'Bhutan', flag: 'ðŸ‡§ðŸ‡¹', dialCode: '975' },
  { code: '+960', country: 'Maldives', flag: 'ðŸ‡²ðŸ‡»', dialCode: '960' },
  { code: '+92', country: 'Pakistan', flag: 'ðŸ‡µðŸ‡°', dialCode: '92' },
  { code: '+93', country: 'Afghanistan', flag: 'ðŸ‡¦ðŸ‡«', dialCode: '93' },
  { code: '+98', country: 'Iran', flag: 'ðŸ‡®ðŸ‡·', dialCode: '98' },
  { code: '+964', country: 'Iraq', flag: 'ðŸ‡®ðŸ‡¶', dialCode: '964' },
  { code: '+965', country: 'Kuwait', flag: 'ðŸ‡°ðŸ‡¼', dialCode: '965' },
  { code: '+966', country: 'Saudi Arabia', flag: 'ðŸ‡¸ðŸ‡¦', dialCode: '966' },
  { code: '+967', country: 'Yemen', flag: 'ðŸ‡¾ðŸ‡ª', dialCode: '967' },
  { code: '+968', country: 'Oman', flag: 'ðŸ‡´ðŸ‡²', dialCode: '968' },
  { code: '+971', country: 'UAE', flag: 'ðŸ‡¦ðŸ‡ª', dialCode: '971' },
  { code: '+973', country: 'Bahrain', flag: 'ðŸ‡§ðŸ‡­', dialCode: '973' },
  { code: '+974', country: 'Qatar', flag: 'ðŸ‡¶ðŸ‡¦', dialCode: '974' },
  { code: '+970', country: 'Palestine', flag: 'ðŸ‡µðŸ‡¸', dialCode: '970' },
  { code: '+972', country: 'Israel', flag: 'ðŸ‡®ðŸ‡±', dialCode: '972' },
  { code: '+961', country: 'Lebanon', flag: 'ðŸ‡±ðŸ‡§', dialCode: '961' },
  { code: '+963', country: 'Syria', flag: 'ðŸ‡¸ðŸ‡¾', dialCode: '963' },
  { code: '+962', country: 'Jordan', flag: 'ðŸ‡¯ðŸ‡´', dialCode: '962' },
  { code: '+996', country: 'Kyrgyzstan', flag: 'ðŸ‡°ðŸ‡¬', dialCode: '996' },
  { code: '+998', country: 'Uzbekistan', flag: 'ðŸ‡ºðŸ‡¿', dialCode: '998' },
  { code: '+992', country: 'Tajikistan', flag: 'ðŸ‡¹ðŸ‡¯', dialCode: '992' },
  { code: '+993', country: 'Turkmenistan', flag: 'ðŸ‡¹ðŸ‡²', dialCode: '993' },
  { code: '+7', country: 'Kazakhstan', flag: 'ðŸ‡°ðŸ‡¿', dialCode: '7' },
  { code: '+976', country: 'Mongolia', flag: 'ðŸ‡²ðŸ‡³', dialCode: '976' },
  { code: '+850', country: 'North Korea', flag: 'ðŸ‡°ðŸ‡µ', dialCode: '850' },
  
  // Africa
  { code: '+20', country: 'Egypt', flag: 'ðŸ‡ªðŸ‡¬', dialCode: '20' },
  { code: '+27', country: 'South Africa', flag: 'ðŸ‡¿ðŸ‡¦', dialCode: '27' },
  { code: '+234', country: 'Nigeria', flag: 'ðŸ‡³ðŸ‡¬', dialCode: '234' },
  { code: '+251', country: 'Ethiopia', flag: 'ðŸ‡ªðŸ‡¹', dialCode: '251' },
  { code: '+254', country: 'Kenya', flag: 'ðŸ‡°ðŸ‡ª', dialCode: '254' },
  { code: '+255', country: 'Tanzania', flag: 'ðŸ‡¹ðŸ‡¿', dialCode: '255' },
  { code: '+256', country: 'Uganda', flag: 'ðŸ‡ºðŸ‡¬', dialCode: '256' },
  { code: '+250', country: 'Rwanda', flag: 'ðŸ‡·ðŸ‡¼', dialCode: '250' },
  { code: '+257', country: 'Burundi', flag: 'ðŸ‡§ðŸ‡®', dialCode: '257' },
  { code: '+243', country: 'DR Congo', flag: 'ðŸ‡¨ðŸ‡©', dialCode: '243' },
  { code: '+242', country: 'Republic of Congo', flag: 'ðŸ‡¨ðŸ‡¬', dialCode: '242' },
  { code: '+237', country: 'Cameroon', flag: 'ðŸ‡¨ðŸ‡²', dialCode: '237' },
  { code: '+236', country: 'Central African Republic', flag: 'ðŸ‡¨ðŸ‡«', dialCode: '236' },
  { code: '+235', country: 'Chad', flag: 'ðŸ‡¹ðŸ‡©', dialCode: '235' },
  { code: '+249', country: 'Sudan', flag: 'ðŸ‡¸ðŸ‡©', dialCode: '249' },
  { code: '+211', country: 'South Sudan', flag: 'ðŸ‡¸ðŸ‡¸', dialCode: '211' },
  { code: '+216', country: 'Tunisia', flag: 'ðŸ‡¹ðŸ‡³', dialCode: '216' },
  { code: '+213', country: 'Algeria', flag: 'ðŸ‡©ðŸ‡¿', dialCode: '213' },
  { code: '+212', country: 'Morocco', flag: 'ðŸ‡²ðŸ‡¦', dialCode: '212' },
  { code: '+218', country: 'Libya', flag: 'ðŸ‡±ðŸ‡¾', dialCode: '218' },
  { code: '+233', country: 'Ghana', flag: 'ðŸ‡¬ðŸ‡­', dialCode: '233' },
  { code: '+225', country: 'Ivory Coast', flag: 'ðŸ‡¨ðŸ‡®', dialCode: '225' },
  { code: '+226', country: 'Burkina Faso', flag: 'ðŸ‡§ðŸ‡«', dialCode: '226' },
  { code: '+223', country: 'Mali', flag: 'ðŸ‡²ðŸ‡±', dialCode: '223' },
  { code: '+222', country: 'Mauritania', flag: 'ðŸ‡²ðŸ‡·', dialCode: '222' },
  { code: '+221', country: 'Senegal', flag: 'ðŸ‡¸ðŸ‡³', dialCode: '221' },
  { code: '+220', country: 'Gambia', flag: 'ðŸ‡¬ðŸ‡²', dialCode: '220' },
  { code: '+224', country: 'Guinea', flag: 'ðŸ‡¬ðŸ‡³', dialCode: '224' },
  { code: '+245', country: 'Guinea-Bissau', flag: 'ðŸ‡¬ðŸ‡¼', dialCode: '245' },
  { code: '+238', country: 'Cape Verde', flag: 'ðŸ‡¨ðŸ‡»', dialCode: '238' },
  { code: '+232', country: 'Sierra Leone', flag: 'ðŸ‡¸ðŸ‡±', dialCode: '232' },
  { code: '+231', country: 'Liberia', flag: 'ðŸ‡±ðŸ‡·', dialCode: '231' },
  { code: '+228', country: 'Togo', flag: 'ðŸ‡¹ðŸ‡¬', dialCode: '228' },
  { code: '+229', country: 'Benin', flag: 'ðŸ‡§ðŸ‡¯', dialCode: '229' },
  { code: '+227', country: 'Niger', flag: 'ðŸ‡³ðŸ‡ª', dialCode: '227' },
  { code: '+230', country: 'Mauritius', flag: 'ðŸ‡²ðŸ‡º', dialCode: '230' },
  { code: '+248', country: 'Seychelles', flag: 'ðŸ‡¸ðŸ‡¨', dialCode: '248' },
  { code: '+261', country: 'Madagascar', flag: 'ðŸ‡²ðŸ‡¬', dialCode: '261' },
  { code: '+269', country: 'Comoros', flag: 'ðŸ‡°ðŸ‡²', dialCode: '269' },
  { code: '+258', country: 'Mozambique', flag: 'ðŸ‡²ðŸ‡¿', dialCode: '258' },
  { code: '+260', country: 'Zambia', flag: 'ðŸ‡¿ðŸ‡²', dialCode: '260' },
  { code: '+263', country: 'Zimbabwe', flag: 'ðŸ‡¿ðŸ‡¼', dialCode: '263' },
  { code: '+267', country: 'Botswana', flag: 'ðŸ‡§ðŸ‡¼', dialCode: '267' },
  { code: '+264', country: 'Namibia', flag: 'ðŸ‡³ðŸ‡¦', dialCode: '264' },
  { code: '+268', country: 'Eswatini', flag: 'ðŸ‡¸ðŸ‡¿', dialCode: '268' },
  { code: '+266', country: 'Lesotho', flag: 'ðŸ‡±ðŸ‡¸', dialCode: '266' },
  { code: '+240', country: 'Equatorial Guinea', flag: 'ðŸ‡¬ðŸ‡¶', dialCode: '240' },
  { code: '+239', country: 'SÃ£o TomÃ© and PrÃ­ncipe', flag: 'ðŸ‡¸ðŸ‡¹', dialCode: '239' },
  { code: '+244', country: 'Angola', flag: 'ðŸ‡¦ðŸ‡´', dialCode: '244' },
  { code: '+253', country: 'Djibouti', flag: 'ðŸ‡©ðŸ‡¯', dialCode: '253' },
  { code: '+252', country: 'Somalia', flag: 'ðŸ‡¸ðŸ‡´', dialCode: '252' },
  { code: '+291', country: 'Eritrea', flag: 'ðŸ‡ªðŸ‡·', dialCode: '291' },
  
  // Oceania
  { code: '+61', country: 'Australia', flag: 'ðŸ‡¦ðŸ‡º', dialCode: '61' },
  { code: '+64', country: 'New Zealand', flag: 'ðŸ‡³ðŸ‡¿', dialCode: '64' },
  { code: '+679', country: 'Fiji', flag: 'ðŸ‡«ðŸ‡¯', dialCode: '679' },
  { code: '+676', country: 'Tonga', flag: 'ðŸ‡¹ðŸ‡´', dialCode: '676' },
  { code: '+685', country: 'Samoa', flag: 'ðŸ‡¼ðŸ‡¸', dialCode: '685' },
  { code: '+684', country: 'American Samoa', flag: 'ðŸ‡¦ðŸ‡¸', dialCode: '684' },
  { code: '+686', country: 'Kiribati', flag: 'ðŸ‡°ðŸ‡®', dialCode: '686' },
  { code: '+687', country: 'New Caledonia', flag: 'ðŸ‡³ðŸ‡¨', dialCode: '687' },
  { code: '+689', country: 'French Polynesia', flag: 'ðŸ‡µðŸ‡«', dialCode: '689' },
  { code: '+690', country: 'Tokelau', flag: 'ðŸ‡¹ðŸ‡°', dialCode: '690' },
  { code: '+691', country: 'Micronesia', flag: 'ðŸ‡«ðŸ‡²', dialCode: '691' },
  { code: '+692', country: 'Marshall Islands', flag: 'ðŸ‡²ðŸ‡­', dialCode: '692' },
  { code: '+680', country: 'Palau', flag: 'ðŸ‡µðŸ‡¼', dialCode: '680' },
  { code: '+675', country: 'Papua New Guinea', flag: 'ðŸ‡µðŸ‡¬', dialCode: '675' },
  { code: '+677', country: 'Solomon Islands', flag: 'ðŸ‡¸ðŸ‡§', dialCode: '677' },
  { code: '+678', country: 'Vanuatu', flag: 'ðŸ‡»ðŸ‡º', dialCode: '678' },
  { code: '+683', country: 'Niue', flag: 'ðŸ‡³ðŸ‡º', dialCode: '683' },
  { code: '+682', country: 'Cook Islands', flag: 'ðŸ‡¨ðŸ‡°', dialCode: '682' },
  { code: '+688', country: 'Tuvalu', flag: 'ðŸ‡¹ðŸ‡»', dialCode: '688' },
  { code: '+674', country: 'Nauru', flag: 'ðŸ‡³ðŸ‡·', dialCode: '674' },
  
  // South America
  { code: '+55', country: 'Brazil', flag: 'ðŸ‡§ðŸ‡·', dialCode: '55' },
  { code: '+54', country: 'Argentina', flag: 'ðŸ‡¦ðŸ‡·', dialCode: '54' },
  { code: '+56', country: 'Chile', flag: 'ðŸ‡¨ðŸ‡±', dialCode: '56' },
  { code: '+57', country: 'Colombia', flag: 'ðŸ‡¨ðŸ‡´', dialCode: '57' },
  { code: '+58', country: 'Venezuela', flag: 'ðŸ‡»ðŸ‡ª', dialCode: '58' },
  { code: '+51', country: 'Peru', flag: 'ðŸ‡µðŸ‡ª', dialCode: '51' },
  { code: '+593', country: 'Ecuador', flag: 'ðŸ‡ªðŸ‡¨', dialCode: '593' },
  { code: '+591', country: 'Bolivia', flag: 'ðŸ‡§ðŸ‡´', dialCode: '591' },
  { code: '+595', country: 'Paraguay', flag: 'ðŸ‡µðŸ‡¾', dialCode: '595' },
  { code: '+598', country: 'Uruguay', flag: 'ðŸ‡ºðŸ‡¾', dialCode: '598' },
  { code: '+597', country: 'Suriname', flag: 'ðŸ‡¸ðŸ‡·', dialCode: '597' },
  { code: '+594', country: 'French Guiana', flag: 'ðŸ‡¬ðŸ‡«', dialCode: '594' },
  { code: '+592', country: 'Guyana', flag: 'ðŸ‡¬ðŸ‡¾', dialCode: '592' },
  
  // Central America & Caribbean
  { code: '+52', country: 'Mexico', flag: 'ðŸ‡²ðŸ‡½', dialCode: '52' },
  { code: '+502', country: 'Guatemala', flag: 'ðŸ‡¬ðŸ‡¹', dialCode: '502' },
  { code: '+503', country: 'El Salvador', flag: 'ðŸ‡¸ðŸ‡»', dialCode: '503' },
  { code: '+504', country: 'Honduras', flag: 'ðŸ‡­ðŸ‡³', dialCode: '504' },
  { code: '+505', country: 'Nicaragua', flag: 'ðŸ‡³ðŸ‡®', dialCode: '505' },
  { code: '+506', country: 'Costa Rica', flag: 'ðŸ‡¨ðŸ‡·', dialCode: '506' },
  { code: '+507', country: 'Panama', flag: 'ðŸ‡µðŸ‡¦', dialCode: '507' },
  { code: '+501', country: 'Belize', flag: 'ðŸ‡§ðŸ‡¿', dialCode: '501' },
  { code: '+53', country: 'Cuba', flag: 'ðŸ‡¨ðŸ‡º', dialCode: '53' },
  { code: '+509', country: 'Haiti', flag: 'ðŸ‡­ðŸ‡¹', dialCode: '509' },
  { code: '+590', country: 'Guadeloupe', flag: 'ðŸ‡¬ðŸ‡µ', dialCode: '590' },
  { code: '+596', country: 'Martinique', flag: 'ðŸ‡²ðŸ‡¶', dialCode: '596' },
  { code: '+599', country: 'CuraÃ§ao', flag: 'ðŸ‡¨ðŸ‡¼', dialCode: '599' },
  { code: '+297', country: 'Aruba', flag: 'ðŸ‡¦ðŸ‡¼', dialCode: '297' },
  { code: '+1787', country: 'Puerto Rico', flag: 'ðŸ‡µðŸ‡·', dialCode: '1787' },
  { code: '+1809', country: 'Dominican Republic', flag: 'ðŸ‡©ðŸ‡´', dialCode: '1809' },
  { code: '+1876', country: 'Jamaica', flag: 'ðŸ‡¯ðŸ‡²', dialCode: '1876' },
  { code: '+1658', country: 'Jamaica', flag: 'ðŸ‡¯ðŸ‡²', dialCode: '1658' },
  { code: '+1868', country: 'Trinidad and Tobago', flag: 'ðŸ‡¹ðŸ‡¹', dialCode: '1868' },
  { code: '+1246', country: 'Barbados', flag: 'ðŸ‡§ðŸ‡§', dialCode: '1246' },
  { code: '+1242', country: 'Bahamas', flag: 'ðŸ‡§ðŸ‡¸', dialCode: '1242' },
  
  // Special Territories & Other
  { code: '+500', country: 'Falkland Islands', flag: 'ðŸ‡«ðŸ‡°', dialCode: '500' },
  { code: '+290', country: 'Saint Helena', flag: 'ðŸ‡¸ðŸ‡­', dialCode: '290' },
  { code: '+246', country: 'British Indian Ocean Territory', flag: 'ðŸ‡®ðŸ‡´', dialCode: '246' },
  { code: '+672', country: 'Antarctica', flag: 'ðŸ‡¦ðŸ‡¶', dialCode: '672' },
  { code: '+299', country: 'Greenland', flag: 'ðŸ‡¬ðŸ‡±', dialCode: '299' },
  { code: '+508', country: 'Saint Pierre and Miquelon', flag: 'ðŸ‡µðŸ‡²', dialCode: '508' }
];

    let countrySelector = document.getElementById('country-selector');
    let phoneInput = document.getElementById('phone');
    
    // Set default country based on Flask variable
    let userCountryCode = '{{ user_country if user_country else "United State" }}';
    let defaultCountry = countries.find(c => c.country === userCountryCode) || countries.find(c => c.dialCode === '1');
    
    // Populate dropdown options
    function populateDropdown() {
        countrySelector.innerHTML = '';
        countries.forEach(country => {
            let option = document.createElement('option');
            option.value = country.code;
            option.textContent = `${country.flag} ${country.code}`;
            option.dataset.dialCode = country.dialCode;
            
            if (country.dialCode === defaultCountry.dialCode) {
                option.selected = true;
            }
            
            countrySelector.appendChild(option);
        });
    }
    
    // Handle phone input changes
    phoneInput.addEventListener('input', function() {
        // Only allow digits, spaces, hyphens, and parentheses
        this.value = this.value.replace(/[^\d\s\-()]/g, '');
    });
    
    // Initialize
    populateDropdown();
    
    return defaultCountry;
}

function initForm() {
    let loginForm = document.getElementById("login-form");
    let nameInput = document.getElementById("name");
    let emailInput = document.getElementById("email");
    let subjectInput = document.getElementById("subject");
    let desgInput = document.getElementById("desg");
    let phoneInput = document.getElementById("phone");
    let phoneContainer = document.getElementById("phone-container");
    let errorMessage = document.getElementById("error-message");

    // Initialize phone input
    let currentCountry = initPhoneInput();

    // Validation regex patterns
    let emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
    let phoneRegex = /^[\d\s\-()]{7,15}$/;

    // Unified error display function
    function showError(message) {
        errorMessage.textContent = message;
        errorMessage.style.display = "block";
    }

    function hideError() {
        errorMessage.textContent = "";
        errorMessage.style.display = "none";
    }

    // Remove error styling from all inputs
    function clearErrorStyling() {
        nameInput.classList.remove("input-error");
        emailInput.classList.remove("input-error");
        phoneContainer.classList.remove("input-error");
        subjectInput.classList.remove("input-error");
        if (desgInput) {
            desgInput.classList.remove("input-error");
        }
    }

    // Form validation function
    function validateForm() {
        hideError();
        clearErrorStyling();

        // Validate name
        if (!nameInput.value.trim()) {
            nameInput.classList.add("input-error");
            showError("Name is required");
            return false;
        }
        if (nameInput.value.trim().length < 2) {
            nameInput.classList.add("input-error");
            showError("Name must be at least 2 characters");
            return false;
        }

        // Validate email
        if (!emailInput.value.trim()) {
            emailInput.classList.add("input-error");
            showError("Email is required");
            return false;
        }
        if (!emailRegex.test(emailInput.value.trim())) {
            emailInput.classList.add("input-error");
            showError("Please enter a valid email address");
            return false;
        }

        // Validate subject
        if (!subjectInput.value.trim()) {
            subjectInput.classList.add("input-error");
            showError("Subject is required");
            return false;
        }

        // Validate designation (if exists)
        if (desgInput && !desgInput.value.trim()) {
            desgInput.classList.add("input-error");
            showError("Designation is required");
            return false;
        }

        // Validate phone
        if (!phoneInput.value.trim()) {
            phoneContainer.classList.add("input-error");
            showError("Phone number is required");
            return false;
        }
        if (!phoneRegex.test(phoneInput.value.trim())) {
            phoneContainer.classList.add("input-error");
            showError("Please enter a valid phone number (7-15 digits)");
            return false;
        }

        return true;
    }

    // Form submission
    loginForm.addEventListener("submit", function (e) {
        e.preventDefault();

        if (!validateForm()) {
            return;
        }

        // Update current country before submission
        currentCountry = document.getElementById('country-selector').value;

        let name = nameInput.value.trim();
        let email = emailInput.value.trim();
        let phone = currentCountry + phoneInput.value.trim().replace(/\D/g, ''); 
        let subject = subjectInput.value.trim();
        let desg = desgInput ? desgInput.value.trim() : "None";
        let isHtmxRequest = document.getElementById("chatbox") !== null;
        
        fetch("{{settings['backend_url']}}/min/auth", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "HX-Request": isHtmxRequest
            },
            credentials: "include",
            body: JSON.stringify({
                name: name,
                email: email,
                phone: phone,
                subject: subject,
                desg: desg
            }),
        })
        .then(async (response) => {
            if (!response.ok) {
                let data = await response.json();
                showError(data.error || "Login failed");
                return;
            }

            if (isHtmxRequest) {
                let text = await response.text();
                htmx.swap('#chatbox', text, {swapStyle: 'innerHTML'});
            } else {
                if (response.redirected) {
                    window.location.href = response.url;
                } else {
                    let text = await response.text();
                }
            }
        })
        .catch((error) => {
            console.error("Error:", error);
            showError("An error occurred. Please try again.");
        });
    });

    // Real-time validation clearing
    [nameInput, emailInput, phoneInput, subjectInput, desgInput].forEach(input => {
        if (input) {
            input.addEventListener("input", function () {
                hideError();
                clearErrorStyling();
            });
        }
    });
}

function showReturnChatButton() {
    let returnButton = document.getElementById('return-chat');
    if (returnButton) {
        returnButton.style.display = 'block';
        
        // Make sure HTMX processes the button
        if (typeof htmx !== 'undefined') {
            htmx.process(returnButton);
        }
    }
}

// Initialize the form when the DOM is fully loaded
document.addEventListener('DOMContentLoaded', function() {
    showReturnChatButton();
    initForm();
});

// Also call it immediately in case the script loads after DOM is ready
showReturnChatButton();
initForm();
</script>
{% endblock %}
